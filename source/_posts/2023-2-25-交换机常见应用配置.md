---
title: 交换机常见场景配置
author: jh2ng
cover: 'https://image.jh2ing.com/image-20230225105256217.png'
tags:
  - 学习笔记
categories:
  - 网络
abbrlink: 34203
date: 2023-02-25 10:30:00
---

### 场景一：端口镜像

> 网络维护过程中会遇到需要对报文进行获取和分析的情况，比如怀疑有攻击报文，此时需要在不影响报文转发的情况下，对报文进行获取和分析。
>
> 镜像可以在不影响报文正常处理流程的情况下，将镜像端口的报文复制一份到观察端口，用户利用数据监控设备来分析复制到观察端口的报文，进行网络监控和故障排除。

*Huawei S5700：配置项*

```
# 配置观察口
[Huawei]observe-port [ observe-port-index ] interface interface-type interface-number
# 配置观察端口组
[Huawei]observe-port group group-id
[Huawei]group-member { interface-type interface-number [ to interface-type interface-number ] } &<1-8>
quit

# 配置本地端口镜像
[Huawei]interface interface-type interface-number
# 配置将端口流量镜像到观察端口或者观察端口组
[Huawei]port-mirroring observe-port { observe-port-index | group group-id } { both | inbound | outbound }

# 配置本地VLAN镜像
[Huawei]vlan vlan-id
[Huawei]mirroring observe-port { observe-port-index | group group-id } { inbound | outbound | both }
```

> both | inbound | outbound分别表示镜像设备双向（接收和发送两个方向）/入方向（接收方向）/出方向（发送方向）的报文。

*H3C S5120：配置项*

```
# 创建本地镜像组
mirroring-group 1 local
为本地镜像组配置源端口和目的端口
mirroring-group 1 mirroring-port gigabitethernet 1/0/1 gigabitethernet 1/0/2 both
mirroring-group 1 monitor-port gigabitethernet 1/0/3
```

### 场景二：以太网链路聚合

> 随着网络规模不断扩大，用户对骨干链路的带宽和可靠性提出越来越高的要求。在传统技术中，常用更换高速率的单板或更换支持高速率单板的设备的方式来增加带宽，但这种方案需要付出高额的费用，而且不够灵活。
>
> Eth-Trunk采用链路聚合技术，可以在不进行硬件升级的条件下，通过将多个物理接口捆绑为一个逻辑接口，达到增加链路带宽的目的。在实现增大带宽目的的同时，Eth-Trunk采用备份链路的机制，可以有效的提高设备之间链路的可靠性。

- 增加带宽

  链路聚合接口的最大带宽可以达到各成员接口带宽之和。

- 提高可靠性

  当某条活动链路出现故障时，流量可以切换到其他可用的成员链路上，从而提高链路聚合接口的可靠性。

- 负载分担

  在一个链路聚合组内，可以实现在各成员活动链路上的负载分担。

*Huawei S5700：配置项*

```
# 创建Eth-Trunk接口并进入Eth-Trunk接口视图
[Huawei]interface Eth-Trunk trunk-id
# 配置链路聚合模式
[Huawei]mode { manual load-balance | lacp-static | lacp-dynamic }

# 添加接口
[Huawei]trunkport interface-type interface-number
```

> 缺省情况下，链路聚合模式为**manual load-balance**。
>
> **manual load-balance**表示手工模式Eth-Trunk，该模式下所有链路都参与负载分担；**lacp-static**表示静态LACP模式Eth-Trunk，**lacp-dynamic**表示动态LACP模式Eth-Trunk。

*H3C S5120：配置项*

```
# 创建二层聚合接口1
interface bridge-aggregation 1
# 将端口GigabitEthernet1/0/1加入到聚合组1中
interface gigabitethernet 1/0/1
port link-aggregation group 1
```
